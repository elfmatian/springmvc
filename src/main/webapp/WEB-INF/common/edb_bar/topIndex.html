<!DOCTYPE html>
<html>
  <head>
    <title>topIndex.html</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-Control" content="no-cache">
	<meta http-equiv="Expires" content="0">
  </head>

  <body>
  
 	 <iframe id="framePage" name="fpage" src="" width=100% scrolling="no" height=100% frameborder=no noResize
		 style="position:absolute; top:0px ; left:0px ; right:0px ; z-index:1" allowfullscreen>
 	 </iframe>
 	 
 	 <div id="allPhone" style=" display:none; width:23px; height:71px; position:absolute; top:41%; right:0px; z-index:3;">
		
		 <div id="closedPhone"  style="width:100%; height:99%;background-image:url(/springmvc/common/edb_bar/imgs/boxtwo.png); border-radius:11px 0px 0px 11px; text-align:center;color:#FFFFFF">
			联<br>
			系<br>
		 </div>
	 	 
		 <iframe id="framePhone" name="fphone" src="" width=100% scrolling="no" height=99% frameborder=no noResize
			 style="display:none;right:0px">
		 </iframe>
		 
	</div>

  </body>
  
  <!-- 自添加脚本 -->
<script type="text/javascript">

//document.getElementById("framework").src = "/springmvc/"+icallcenter.logon.getUrlValue("urlStr");
document.getElementById("framePage").src = "/springmvc/"+window.location.href.split("=")[1].split("&")[0];

var allbox = document.getElementById("allPhone");//整块
var boxone = document.getElementById("framePhone");//展开
var boxtwo = document.getElementById("closedPhone");//闭合

//是否启用电话条
var isOrNo = true;

var loginName = "";
var password = "";
var extenType = "gateway";

window.onload = window.onresize = window.onscroll = function (){
	//鼠标覆盖，展开
	allbox.onmouseover = function (){
		opendiv();
	};
	//鼠标移开，收起
	allbox.onmouseout = function (){
		closediv();
	};	
}

//phone界面对象
var phone = document.getElementById("framePhone").contentWindow;

//拨号,展开
function callTell(num){
	if(phone.softphoneBar == null){
		alert("抱歉，您没有拨号功能权限！");
	}else{
		phone.document.getElementById("icallcenter.dialout.input").value = num;//张比思：18987465903;坤哥：15394971279
		phone.softphoneBar.dialout(num);//调用电话条拨号
		opendiv();
	}
}

//来电触发该方法,展开
function trafficTell(phoneJson){
	opendiv();
	if(document.getElementById("framePage").contentWindow.handlerTell && typeof(document.getElementById("framePage").contentWindow.handlerTell) == "function"){
		console.log("来电方法调用");
		document.getElementById("framePage").contentWindow.handlerTell(phoneJson);//号码传递给业务界面
		console.log("来电调用完成");
	}else{
		console.log("没有来电方法");
	}
}

//展开电话条
function opendiv(){
	allbox.style.width = 110 + "px";
	allbox.style.height = 70 + "%";
	allbox.style.top = 17 + "%";
	allbox.style.overflow = "hidden";
	boxone.style.display = "block";
	boxtwo.style.display = "none";
}

//闭合电话条
function closediv(){
	allbox.style.width = 23 + "px";
	allbox.style.height = 71 + "px";
	allbox.style.top = 41 + "%";
	boxone.style.display = "none";
	boxtwo.style.display = "block";
}

//是否开启电话条功能
if(isOrNo){
	//到后台查询电话条用户名和密码
	var XHR=null;  
	//创建ajax
	if (window.XMLHttpRequest) {  
	    XHR = new XMLHttpRequest();  
	} else if (window.ActiveXObject) {  
	    XHR = new ActiveXObject("Microsoft.XMLHTTP");  
	} else {  
	    XHR = null;  
	} 
	//发送ajax
	if(XHR){  
	    XHR.open("GET", "/springmvc/emp/searchEmpInfo");  
	    XHR.onreadystatechange = function () {
	        if (XHR.readyState == 4 && XHR.status == 200) {
	        	loginName = XHR.responseText.split("-")[1].split("-")[0]+"@lxkj";
	        	password = XHR.responseText.split("-")[2].split("-")[0];
	            //登录电话条
	            if(loginName.length!=0 && password.length!=0){
	            	//document.getElementById("allPhone").style.display = "block";
	            	document.getElementById("framePhone").src = "/springmvc/common/edb_bar/phoneBar/phonebar.html?loginName="+loginName+"&password="+password+"&extenType="+extenType;
	            }
	            XHR = null;
	        }
	    };  
	    XHR.send();  
	}
}
</script>
<!-- main.js提供一个接受来电方法  handlerTell(phoneJson)  -->
<!-- main.js拨号请调用Swet.phone.call(需要拨号号码); -->
  
</html>
